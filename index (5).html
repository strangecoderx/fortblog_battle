<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Fortblog: –ë–∏—Ç–≤–∞ –ß–µ–º–ø–∏–æ–Ω–æ–≤</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0; background: #111; color: #fff; font-family: "BattleFest", sans-serif; text-align: center;
  }
  #game {
    max-width: 480px; margin: auto; padding: 10px;
  }
  button {
    cursor: pointer;
    background: #222;
    border: 1px solid #444;
    border-radius: 10px;
    color: white;
    padding: 10px;
    font-size: 16px;
    margin: 5px 0;
    width: 90%;
  }
  .fighter-select, #skins {
    display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;
  }
  .roster-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
  padding: 20px;
}
.flipped {
  transform: scaleX(-1);
}
.damage-popup {
  position: absolute;
  color: yellow;
  font-size: 20px;
  font-weight: bold;
  animation: floatUp 0.8s ease-out forwards;
  pointer-events: none;
  z-index: 10;
  text-shadow: 1px 1px 2px #000;

  transform: translateX(-50%);
  left: 50%;
  top: 0;
}

.damage-popup.no-flip {
  transform: translateX(-50%) scaleX(1) !important;
}
.fighter-card {
  width: 100px;
  text-align: center;
  cursor: pointer;
  border: 3px solid transparent;
  border-radius: 12px;
  padding: 8px;
  background: linear-gradient(to bottom, #871F78, #2a2a2a);
  transition: all 0.2s ease;
  box-shadow: 0 0 4px #000;
}

.fighter-card:hover {
  border-color: #a64dff;
  box-shadow: 0 0 10px #a64dff;
  transform: scale(1.05);
}

.fighter-card img {
  width: 80px;
  height: 80px;
  border-radius: 8px;
  object-fit: cover;
  background-color: #000;
}

.fighter-name {
  margin-top: 6px;
  font-size: 14px;
  color: deeppink !important;
  text-shadow: 1px 1px 2px #000;
  word-break: break-word;
  white-space: normal;
}
  @keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-50px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

#scenePlayer.animate-in {
  animation: slideInLeft 1s ease-out;
}
  @keyframes shinyBorder {
  0% { border-color: #a64dff; box-shadow: 0 0 4px #a64dff; }
  50% { border-color: #d966ff; box-shadow: 0 0 12px #e580ff; }
  100% { border-color: #a64dff; box-shadow: 0 0 4px #a64dff; }
}

@keyframes fadeOut {
  0% { opacity: 1; }
  100% { opacity: 0; transform: scale(0.7); }
}
.fade-out {
  animation: fadeOut 0.6s forwards;
}

.tower-skin {
  animation: shinyBorder 1.5s infinite;
  border: 3px solid #a64dff;
  border-radius: 8px;
}
.butbot-skin {
  border: 2px solid deeppink;
  animation: glowPink 1.5s infinite;
}

@keyframes glowPink {
  0% { box-shadow: 0 0 4px deeppink; }
  50% { box-shadow: 0 0 12px hotpink; }
  100% { box-shadow: 0 0 4px deeppink; }
}
  #arena {
    background-size: cover;
    background-position: center;
    padding-top: 20px;
    padding-bottom: 10px;
    margin-bottom: 10px;
  }
.character {
  display: inline-block;
  margin: 0 10px;
  vertical-align: top;
  user-select: none;
  position: relative;
  top: 20px; /* –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ –æ–ø—É—â–µ–Ω—ã –≤–Ω–∏–∑ */
}
  .character img {
    width: 140px;
    height: 140px;
    object-fit: contain;
  }
  .enemyImg {
    .tower-skin {
  border: 2px solid cyan;
  animation: glowTower 1.5s infinite;
}

@keyframes glowTower {
  0% { box-shadow: 0 0 4px cyan; }
  50% { box-shadow: 0 0 12px cyan; }
  100% { box-shadow: 0 0 4px cyan; }
}

.butbot-skin {
  border: 2px solid deeppink;
  animation: glowPink 1.5s infinite;
}

@keyframes glowPink {
  0% { box-shadow: 0 0 4px deeppink; }
  50% { box-shadow: 0 0 12px hotpink; }
  100% { box-shadow: 0 0 4px deeppink; }
}
  }
  .damage-popup {
  position: absolute;
  color: yellow;
  font-size: 20px;
  font-weight: bold;
  animation: floatUp 0.8s ease-out forwards;
  pointer-events: none;
  z-index: 10;
  text-shadow: 1px 1px 2px #000;
}

@keyframes floatUp {
  from { opacity: 1; transform: translateY(0); }
  to { opacity: 0; transform: translateY(-40px); }
}
@keyframes arenaFadeIn {
  0% {
    opacity: 0;
    transform: scale(0.95);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}
.arena-animate {
  animation: arenaFadeIn 1s ease-out;
}
@keyframes textFadeInUp {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}
.collection-card {
  width: 140px;
  background: #1a1a1a;
  border: 2px solid #444;
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  box-shadow: 0 0 6px #000;
  transition: transform 0.2s ease;
}
.collection-card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 12px #a64dff;
}
.collection-card-title {
  font-weight: bold;
  margin-bottom: 8px;
  color: white;
  text-shadow: 1px 1px 3px #000;
}
.collection-skins {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 6px;
}
.collection-skins img {
  width: 50px;
  height: 50px;
  border-radius: 6px;
  background: black;
  object-fit: cover;
  border: 2px solid #222;
}
.locked-skin {
  opacity: 0.3;
  filter: grayscale(100%);
}
@keyframes buttonPop {
  from {
    opacity: 0;
    transform: scale(0.8) translateY(10px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.action-button-animate {
  animation: buttonPop 0.3s ease-out;
}
.unlocked-skin {
  border: 2px solid violet;
  animation: shinyBorder 1.5s infinite;
}
.tower-text-animate {
  animation: textFadeInUp 1s ease-out forwards;
}
.flash-hit {
  animation: flash 0.3s;
}
@keyframes skinReveal {
  0% { transform: scale(0.7); opacity: 0; filter: brightness(1); }
  30% { transform: scale(1.2); opacity: 1; filter: brightness(2) drop-shadow(0 0 10px gold); }
  100% { transform: scale(1); filter: brightness(1.2); }
}
.skin-reveal-anim {
  animation: skinReveal 1.2s ease-out;
  z-index: 10;
}
.rage-glow {
  animation: greenGlow 1s infinite alternate;
}
@keyframes greenGlow {
  0% { filter: drop-shadow(0 0 5px limegreen); }
  100% { filter: drop-shadow(0 0 15px lime); }
}
@font-face {
  font-family: 'BattleFest';
  src: url('fortnitebattlefest.ttf') format('truetype');
}
@keyframes shinyBorder {
  0% { box-shadow: 0 0 4px #a64dff; }
  50% { box-shadow: 0 0 12px #e580ff; }
  100% { box-shadow: 0 0 4px #a64dff; }
}
@keyframes flash {
  0% { filter: brightness(1); }
  50% { filter: brightness(2); }
  100% { filter: brightness(1); }
}
@keyframes bossGlow {
  0% { filter: drop-shadow(0 0 5px violet); }
  50% { filter: drop-shadow(0 0 15px purple); }
  100% { filter: drop-shadow(0 0 5px violet); }
}
.shop-skin {
  border: 2px solid gold;
  animation: goldShine 2s infinite;
}
@keyframes goldShine {
  0% { box-shadow: 0 0 4px gold; }
  50% { box-shadow: 0 0 12px yellow; }
  100% { box-shadow: 0 0 4px gold; }
}
.boss-glow {
  animation: bossGlow 2s infinite;
}
  .bar {
    height: 12px;
    background: #555;
    margin: 6px 0;
    border-radius: 6px;
    overflow: hidden;
  }
  .hp {
    background: red;
    height: 100%;
    width: 100%;
  }
  @keyframes fighterPopIn {
  from {
    opacity: 0;
    transform: translateY(30px) scale(0.9);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.fighter-card.animate-in {
  animation: fighterPopIn 0.4s ease-out;
}
  .shop-card {
  width: 140px;
  background: #1a1a1a;
  border: 2px solid #555;
  border-radius: 12px;
  padding: 10px;
  text-align: center;
  box-shadow: 0 0 6px #000;
  transition: transform 0.2s ease;
}
.shop-card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 12px gold;
}
.shop-card img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 8px;
  background-color: #000;
}
.shop-card-name {
  margin-top: 8px;
  font-weight: bold;
  color: gold;
  text-shadow: 1px 1px 3px #000;
  font-size: 14px;
}
.shop-card-price {
  color: #ccc;
  margin: 5px 0;
  font-size: 13px;
}
  .vsc {
    background: linear-gradient(to right, cyan, lime);
    height: 100%;
    width: 100%;
  }
  #actions button:disabled {
    opacity: 0.4;
    cursor: default;
  }
  #log {
    font-size: 14px;
    min-height: 50px;
    margin-top: 10px;
    min-height: 48px;
  }
.silhouette {
  filter: brightness(0) drop-shadow(0 0 20px violet);
  opacity: 0.7;
  animation: scaleIn 0.8s ease-out;
}
@keyframes scaleIn {
  from { transform: scale(0.5); opacity: 0; }
  to { transform: scale(1); opacity: 0.7; }
}
@media (max-width: 480px) {
  #faceoff-scene img {
    width: 40vw; /* –º–∞–∫—Å–∏–º—É–º 40% —à–∏—Ä–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞ */
  }

  #faceoff-scene img[src*="vs.png"] {
    width: 16vw; /* –∏–∫–æ–Ω–∫–∞ VS ‚Äî –ø–æ–º–µ–Ω—å—à–µ */
  }

  #faceoff-countdown {
    font-size: 36px;
  }
}
  #main-menu {
    margin-top: 30px;
  }
</style>
</head>
<body>
<div id="game">
  <h1>Fortblog: –ë–∏—Ç–≤–∞ –ß–µ–º–ø–∏–æ–Ω–æ–≤</h1>

  <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
  <div id="main-menu">
    <button id="btnCampaign">–ë–∞—à–Ω—è</button>
    <button id="btnQuickFight">–ë—ã—Å—Ç—Ä—ã–π –±–æ–π</button>
    <button id="btnRecords">–†–µ–∫–æ—Ä–¥—ã</button>
    <button id="btnShop">–ú–∞–≥–∞–∑–∏–Ω</button>
    <button id="btnCollection">–ö–æ–ª–ª–µ–∫—Ü–∏—è</button>
  </div>
  <!-- –ú–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –±–∞—à–Ω–∏ -->
<div id="tower-type-menu" style="display:none; padding:20px; text-align:center;">
  <button id="btnTowerShlyan">–ë–ê–®–ù–Ø –®–õ–Ø–ù–ê</button>
  <button id="btnTowerBut">–ë–ê–®–ù–Ø –î–û–ö–¢–û–†–ê –ë–£–¢–ê</button>
  <button id="btnBackToMain">–ù–ê–ó–ê–î –í –ú–ï–ù–Æ</button>
</div>
<div id="tower-scene" style="display:none; padding:20px;">
  <div style="max-width:480px; margin:auto;">
    <div id="towerContainer" style="position:relative; width:100%; height:240px; background:#111; border:2px solid #333; border-radius:12px; overflow:hidden;">
      <img id="scenePlayer" src="" style="position:absolute; bottom:0; left:0; width:130px; z-index:2;">
      <img id="sceneTower" src="tower.png" style="position:absolute; bottom:0; right:0; height:240px; z-index:1;">
      <div id="sceneText" style="
        position:absolute;
        top:20px;
        right:20px;
        color:white;
        font-size:18px;
        text-align:right;
        text-shadow:2px 2px 4px #000;
        max-width: 160px;
        z-index:3;
        opacity: 0;
        transform: translateY(20px);
        transition: all 1s ease;
      ">
        <div style="font-weight:bold; font-size:22px;">–ë–∞—à–Ω—è –∂–¥—ë—Ç...</div>
        <div style="margin-top:10px;">–¢—ã –≥–æ—Ç–æ–≤ –ø—Ä–æ–π—Ç–∏ –ø—É—Ç—å –¥–æ –≤–µ—Ä—à–∏–Ω—ã –∏ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –ê–ë–°–û–õ–Æ–¢–ù–´–ú –®–õ–Ø–ù–û–ú?</div>
      </div>
    </div>
    <button id="btnStartTower" style="margin-top:20px; width:100%;">–í –±–æ–π!</button>
  </div>
</div>
<!-- –ú–∞–≥–∞–∑–∏–Ω -->
<div id="shop" style="display:none;">
  <h2>–ú–∞–≥–∞–∑–∏–Ω —Å–∫–∏–Ω–æ–≤</h2>
  <p>–ú–æ–Ω–µ—Ç: <span id="coinCount">0</span></p>
  <div id="shopList" style="display:flex; flex-wrap:wrap; justify-content:center; gap:20px;"></div>
  <button id="btnBackFromShop">–ù–∞–∑–∞–¥</button>
</div>
  <!-- –í—ã–±–æ—Ä –±–æ–π—Ü–∞ -->
  <div id="fighter-select" style="display:none;">
    <h3>–í—ã–±–µ—Ä–∏ –±–æ–π—Ü–∞:</h3>
    <div id="rosterGrid" class="roster-grid"></div>
    <div class="fighter-select" id="fighter-list"></div>
      <button onclick="showMainMenu()">–ù–∞–∑–∞–¥</button>
  </div>

  <!-- –í—ã–±–æ—Ä —Å–∫–∏–Ω–∞ -->
  <div id="skin-select" style="display:none;">
    <h3>–í—ã–±–µ—Ä–∏ –æ–±–ª–∏–∫:</h3>
    <div id="skins"></div>
  </div>

  <!-- –ë–æ–π -->
  <div id="battle" style="display:none;">
    <div id="towerProgress" style="margin:10px; font-weight:bold; display:none;"></div>
    <div id="arena" style="height:250px;">
<div class="character" id="playerChar">
  <div class="bar"><div class="hp" id="playerHP"></div></div>
  <div class="bar"><div class="vsc" id="playerVSC"></div></div>
  <img id="playerImg" src="" alt="–ò–≥—Ä–æ–∫" draggable="false" />
</div>
      	<div class="character" id="enemyChar">

  <div class="bar"><div class="hp" id="enemyHP"></div></div>
  <div class="bar"><div class="vsc" id="enemyVSC"></div></div>
<img id="enemyImg" class="enemyImg" src="" alt="–í—Ä–∞–≥" draggable="false" />
</div>
    </div>
    <div id="actions"></div>
    <div id="log"></div>
  </div>

  <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
  <div id="result" style="display:none;">
    <h2 id="resultText"></h2>
    <p id="stats"></p>
    <button id="btnToMenu">–í –º–µ–Ω—é</button>
    <button id="btnReplay">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –±–æ–π</button>
    <button id="btnToRoster">–í —Ä–æ—Å—Ç–µ—Ä</button>
  </div>
</div>
  <div id="records" style="display:none;">
  <h2>–†–µ–∫–æ—Ä–¥—ã –ë–∞—à–Ω–∏</h2>
  <div id="recordsList"></div>
  <button id="btnBackFromRecords">–ù–∞–∑–∞–¥</button>
</div>
<!-- –ö–æ–ª–ª–µ–∫—Ü–∏—è -->
<div id="collection" style="display:none;">
  <h2>–ö–æ–ª–ª–µ–∫—Ü–∏—è</h2>
  <div id="collectionList" style="display:flex; flex-wrap:wrap; justify-content:center; gap:20px;"></div>
  <button id="btnBackFromCollection">–ù–∞–∑–∞–¥</button>
</div>
<script>
  // –ë–æ–π—Ü—ã –∏ –∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
 const fighters = {
  "–í–û–ù–Ø–õ–ö": {
    hpMax: 120,
    vscMax: 100,
    sprite: ["–≤–æ–Ω—è–ª–∫.png", "–≤–æ–Ω—è–ª–∫2.png"],
    mini: "–≤–æ–Ω—è–ª–∫_–º–∏–Ω–∏.png",
    moves: [
      { name: "üí® –¢–æ–∫—Å–∏—á–Ω—ã–π —É–¥–∞—Ä", cost: 20, dmg: 18 },
      { name: "üí∏ –í–∑—è—Ç—å –≤ –¥–æ–ª–≥", cost: 25, dmg: 22 },
      { name: "üèãÔ∏è‚Äç‚ôÇÔ∏è –î–æ–ª–≥–æ–≤–æ–π –Ω–∞–ø–æ—Ä", cost: 30, dmg: 28 },
      { name: "‚ò£Ô∏è –ì–∞–∑–æ–≤–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ", cost: 35, dmg: 35 },
      { name: "ü•§ –ú–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è", cost: 0, restore: 35 }
    ]
  },

  "–Ø–ù–¢–ê–†–ù–´–ô –®–õ–Ø–•": {
    hpMax: 130,
    vscMax: 90,
    sprite: ["—à–ª—è—Ö.png","—à–ª—è—Ö2.png"], 
    mini: "—à–ª—è—Ö_–º–∏–Ω–∏.png",
    moves: [
      { name: "üß± –£–¥–∞—Ä —è–Ω—Ç–∞—Ä—è", cost: 20, dmg: 20 },
      { name: "üî∂ –ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π –ª—É—á", cost: 30, dmg: 30 },
      { name: "‚ö° –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –≤—Å–ø–ª–µ—Å–∫", cost: 35, dmg: 33 },
      { name: "üåã –ò–º–ø—É–ª—å—Å –ø—Ä–∞–≤–æ—Å—É–¥–∏—è", cost: 40, dmg: 38 },
      { name: "‚òï –ü–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∞ —Å–≤–µ—Ç–æ–º", cost: 0, restore: 30 }
    ]
  },

  "–®–õ–Ø–ù": {
    hpMax: 110,
    vscMax: 100,
    sprite: ["—à–ª—è–Ω.png","—à–ª—è–Ω2.png"],
    mini: "—à–ª—è–Ω_–º–∏–Ω–∏.png",
    moves: [
      { name: "ü¶† –ë—É—Ä–µ–≤–æ–π –≤—ã–±—Ä–æ—Å", cost: 20, dmg: 20 },
      { name: "üíâ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ —Ç–∫–∞–Ω–µ–π", cost: 30, dmg: 28 },
      { name: "‚ò£Ô∏è –ó–∞—Ä–∞–∂—ë–Ω–Ω—ã–π —Ä–∞–∑–ª–æ–º", cost: 35, dmg: 30 },
      { name: "üß¨ –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –º—É—Ç–∞—Ü–∏—è", cost: 40, dmg: 35 },
      { name: "üß´ –°–∞–º–æ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è", cost: 0, restore: 30 }
    ]
  },
  
"–ê–ë–°–û–õ–Æ–¢–ù–´–ô –®–õ–Ø–ù": {
  hpMax: 170, // –±–æ–ª—å—à–µ –•–ü
  vscMax: 120, // –±–æ–ª—å—à–µ –í–°–ö
  sprite: ["—à–ª—è–Ω.png"],
  mini: "—à–ª—è–Ω_–º–∏–Ω–∏.png",
  moves: [
    { name: "ü¶† –ë—É—Ä–µ–≤–æ–π –≤—ã–±—Ä–æ—Å", cost: 20, dmg: 26 },
    { name: "üíâ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ —Ç–∫–∞–Ω–µ–π", cost: 30, dmg: 33 },
    { name: "‚ò£Ô∏è –ó–∞—Ä–∞–∂—ë–Ω–Ω—ã–π —Ä–∞–∑–ª–æ–º", cost: 35, dmg: 36 },
    { name: "üß¨ –ú—É—Ç–∞–Ω—Ç—Å–∫–æ–µ –±–µ—à–µ–Ω—Å—Ç–≤–æ", cost: 40, dmg: 42 },
    { name: "üß´ –°–≤–µ—Ä—Ö—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è", cost: 0, restore: 40 }
  ]
}, 

  "–ë–†–ò–ù–ß 3000": {
    hpMax: 125,
    vscMax: 110,
    sprite: ["–±—Ä–∏–Ω—á.png","–±—Ä–∏–Ω—á2.png"],
    mini: "–±—Ä–∏–Ω—á_–º–∏–Ω–∏.png",
    moves: [
      { name: "üî© –ú–µ—Ö–∞–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É–¥–∞—Ä", cost: 25, dmg: 24 },
      { name: "üì° –¢–µ—Ö–Ω–æ-–∏–º–ø—É–ª—å—Å", cost: 30, dmg: 27 },
      { name: "‚öôÔ∏è –¢—É—Ä–±–æ-—à—Ç–æ—Ä–º", cost: 35, dmg: 32 },
      { name: "üíæ –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —è–¥—Ä–∞", cost: 40, dmg: 36 },
      { name: "üîã –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–∑–∞—Ä—è–¥–∫–∏", cost: 0, restore: 35 }
    ]
  },

  "–ö–ê–ó–ê–•-–ü–ê–£–ö": {
    hpMax: 115,
    vscMax: 90,
    sprite: ["–∫–∞–∑–∞—Ö.png","–∫–∞–∑–∞—Ö2.png"],
    mini: "–∫–∞–∑–∞—Ö_–º–∏–Ω–∏.png", 
    moves: [
      { name: "üï∑Ô∏è –£–∫—É—Å —Å—Ç–µ–ø–Ω–æ–≥–æ –æ—Ö–æ—Ç–Ω–∏–∫–∞", cost: 20, dmg: 20 },
      { name: "üï∏Ô∏è –ó–∞—Ö–≤–∞—Ç –ø–∞—É—Ç–∏–Ω–æ–π", cost: 30, dmg: 28 },
      { name: "üê´ –ü—Ä—ã–∂–æ–∫ –∏–∑ –∞—É–ª–∞", cost: 35, dmg: 32 },
      { name: "üèπ –°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –Ω–∏—Ç—å", cost: 40, dmg: 36 },
      { name: "ü•õ –ö—É–º—ãc–Ω–∞—è –º–µ–¥–∏—Ç–∞—Ü–∏—è", cost: 0, restore: 30 }
    ]
  },

  "–ì–£–ì–ê–î": {
    hpMax: 120,
    vscMax: 100,
    sprite: ["–≥—É–≥–∞–¥.png","–≥—É–≥–∞–¥2.png"],
    mini: "–≥—É–≥–∞–¥_–º–∏–Ω–∏.png", 
    moves: [
      { name: "üßÉ –ê—Ç–∞–∫–∞ —Å–æ–∫–æ–º", cost: 20, dmg: 18 },
      { name: "üìÑ –°—É–¥–µ–±–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ", cost: 30, dmg: 26 },
      { name: "üß† –õ–æ–≤—É—à–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞", cost: 35, dmg: 30 },
      { name: "üíº –¢—Ä–æ–ª–ª–∏–Ω–≥–æ–≤—ã–π –ø—Ä–µ—Å—Å–∏–Ω–≥", cost: 40, dmg: 35 },
      { name: "ü•§ –ü—å—é —Å–æ–∫", cost: 0, restore: 35 }
    ]
  },

  "–î–û–õ–ì–ú–≠–ù": {
    hpMax: 130,
    vscMax: 90,
    sprite: ["–¥–æ–ª–≥–º–µ–Ω.png"," –¥–æ–ª–≥–º–µ–Ω2.png","–¥–æ–ª–≥–º–µ–Ω3.png"],
    mini: "–¥–æ–ª–≥–º–µ–Ω_–º–∏–Ω–∏.png", 
    moves: [
      { name: "üéØ –ú–µ—Ç–Ω—É—Ç—å –¥–æ–ª–≥–æ—Ä–∞–Ω–≥–∏", cost: 20, dmg: 20 },
      { name: "üî¶ –õ—É—á –ø—Ä–∞–≤–æ—Å—É–¥–∏—è", cost: 30, dmg: 28 },
      { name: "üõ†Ô∏è –ó–∞–ø—É—Å–∫ –î–æ–ª–≥–∫—Ä—ã–ª–∞", cost: 35, dmg: 32 },
      { name: "üß® –û–≥–æ–Ω—å –∏–∑ –î–æ–ª–≥—Ç–∞–Ω–∫–∞", cost: 40, dmg: 36 },
      { name: "üí≥ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞", cost: 0, restore: 30 }
    ]
  },

  "–†–û–ú–ú–ò–ù": {
    hpMax: 115,
    vscMax: 95,
    sprite: ["—Ä–æ–º–º–∏–Ω.png","—Ä–æ–º–º–∏–Ω2.png"],
    mini: "—Ä–æ–º–º–∏–Ω_–º–∏–Ω–∏.png", 
    moves: [
      { name: "ü§∏ –ú–∞–Ω–µ–≤—Ä —É–∫–ª–æ–Ω–µ–Ω–∏—è", cost: 20, dmg: 22 },
      { name: "üìâ –ë—Ä–æ—Å–æ–∫ –∫—Ä–µ–¥–∏—Ç–æ—Ä–∞–Ω–≥–∞", cost: 30, dmg: 28 },
      { name: "ü™Å –£–¥–∞—Ä —à–µ—Å—Ç–æ–º", cost: 35, dmg: 30 },
      { name: "üï∂Ô∏è –¢–µ–Ω–µ–≤–∞—è –∞—Ç–∞–∫–∞", cost: 40, dmg: 34 },
      { name: "üçå –¢–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ", cost: 0, restore: 35 }
    ]
  },
  
  "–ê–ö–í–ê–ë–ï–ë–°": {
  hpMax: 125,
  vscMax: 100,
  sprite: ["–∞–∫–≤–∞–±–µ–±—Å.png","–∞–∫–≤–∞–±–µ–±—Å2.png"],
  mini: "–∞–∫–≤–∞–±–µ–±—Å_–º–∏–Ω–∏.png",
  moves: [
    { name: "üåä –ñ–∏–≤–æ—Ç–Ω—ã–π –≤—Å–ø–ª–µ—Å–∫", cost: 25, dmg: 22 },
    { name: "üçñ –®–∞—É—Ä–º–æ–≥–µ–¥–¥–æ–Ω", cost: 35, dmg: 35 },
    { name: "üßú‚Äç‚ôÇÔ∏è –ú–æ—Ä—Å–∫–æ–π –ø—Ä–∏–∫–æ–ª", cost: 20, dmg: 18 },
    { name: "ü¶ë –ü—Ä–∏–∑—ã–≤ –∫–∞–ª—å–º–∞—Ä–∞", cost: 40, dmg: 42 },
    { name: "ü•§ –ü–∞—É–∑–∞ –Ω–∞ —à–∞–≤—É (–±–µ–∑ —Ç–æ–º–∞—Ç–æ–≤)", cost: 0, restore: 35 }
  ]
}, 
"–†–ò–§–§–û–¢–í–û–†–ï–¶": {
  hpMax: 125,
  vscMax: 100,
  sprite: ["—Ä–∏—Ñ—Ñ.png", "—Ä–∏—Ñ—Ñ2.png"],
  mini: "—Ä–∏—Ñ—Ñ_–º–∏–Ω–∏.png",
  moves: [
    { name: "üé∏ Kill 'em All –≤–æ–ª–Ω–∞", cost: 20, dmg: 20 },
    { name: "üöÄ –ß–µ–ª–æ—Ç–æ—Ä–ø–µ–¥–∞", cost: 30, dmg: 28 },
    { name: "üç∫ –ó–∞–ø–æ–π–Ω—ã–π —Ä—ã–≤–æ–∫", cost: 35, dmg: 32 },
    { name: "ü™ê –ê–Ω—Ç–∏–≥—Ä–∞–≤–∏-—à—Ç–æ—Ä–º", cost: 40, dmg: 38 },
    { name: "üçª –Ø –Ω–∞–ø–∏—Å–∞–ª... –í—Å—é –º–µ—Ç–∞–ª–ª–∏–∫—É!", cost: 0, restore: 35 }
  ]
}, 
// –î–æ–∫—Ç–æ—Ä –ë—É—Ç ‚Äî –±–æ—Å—Å –≤ –±–∞—à–Ω–µ –ë–£–¢–ê
"–î–û–ö–¢–û–† –ë–£–¢": {
  hpMax: 100,
  vscMax: 100,
  sprite: ["–¥–æ–∫–±—É—Ç.png", "–¥–æ–∫–±—É—Ç2.png"],
  mini: "–¥–æ–∫–±—É—Ç_–º–∏–Ω–∏.png",
  moves: [
    { name: "üß™ –ë—É—Ç-—Ç–µ—Å—Ç", cost: 20, dmg: 20 },
    { name: "ü¶¥ –ü–æ—Å–æ–±–∏–µ –ø—Ä–∞–≤–¥—ã", cost: 30, dmg: 30 },
    { name: "üß† 10 –ø—Ä–∏—á–∏–Ω –∫—É–ø–∏—Ç—å –∫–∞–ª–¥—É", cost: 35, dmg: 35 },
    { name: "üßº –ù–µ –ø–æ–Ω–∏–º–∞—é!!!", cost: 40, dmg: 40 },
    { name: "ü•§ –ú–µ–¥—Å–µ—Å—Ç—Ä–∏–Ω—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ", cost: 0, restore: 35 }
  ]
},

// –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ë—É—Ç ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–∫—Ä—ã—Ç—ã–π –±–æ—Å—Å
"–ê–ë–°–û–õ–Æ–¢–ù–´–ô –ë–£–¢": {
  hpMax: 180,
  vscMax: 100,
  sprite: ["–∞–±—Å–±—É—Ç.png"],
  mini: "–∞–±—Å–±—É—Ç_–º–∏–Ω–∏.png",
  moves: [
    { name: "‚ò£Ô∏è –†–æ–∑–æ–≤—ã–µ –º–µ–¥–≤–µ–¥–∏", cost: 25, dmg: 30 },
    { name: "üß¨ –°–≤–µ—Ä—Ö–±—É—Ç—Ä–∏–≥—Å", cost: 35, dmg: 40 },
    { name: "ü¶† –ë—É—Ç-—Ö–∞–æ—Å", cost: 45, dmg: 50 },
    { name: "üíä –ú–µ–≥–∞-—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è", cost: 0, restore: 45 }
  ]
},
"–ì–†–û–ó–ù–ï–ô–ù": {
  hpMax: 130,
  vscMax: 80,
  sprite: ["–≥—Ä–æ–∑–Ω–µ–π–Ω.png", "–≥—Ä–æ–∑–Ω–µ–π–Ω2.png"],
  mini: "–≥—Ä–æ–∑–Ω–µ–π–Ω_–º–∏–Ω–∏.png",
  moves: [
    { name: "üí• –£–¥–∞—Ä –≤–µ–Ω–æ–∑–Ω–æ–π —è—Ä–æ—Å—Ç–∏", cost: 25, dmg: 25 },
    { name: "üß™ –ò–Ω—ä–µ–∫—Ü–∏—è —è—Ä–æ—Å—Ç–∏", cost: 35, dmg: 35 },
    { name: "ü©∏ –¢—Ä—É–±–æ—á–Ω—ã–π –ø—Ä–æ—Ä—ã–≤", cost: 40, dmg: 40 },
    { name: "üíâ –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å—ã–≤–æ—Ä–æ—Ç–∫–æ–π", cost: 50, dmg: 50 },
    { name: "üß™ –£—Å–∏–ª–µ–Ω–∏–µ —Å—ã–≤–æ—Ä–æ—Ç–∫–æ–π", cost: 0, buff: "rage", duration: 3 }, 
    { name: "üîã –ü–æ–¥–ø–∏—Ç–∫–∞ –∫–∞–Ω–∏—Å—Ç—Ä–æ–π", cost: 0, restore: 30 }
  ]
}, 
}
  const shopSkinAvailable = [
  "–í–û–ù–Ø–õ–ö", 
  "–Ø–ù–¢–ê–†–ù–´–ô –®–õ–Ø–•", 
  "–ö–ê–ó–ê–•-–ü–ê–£–ö", 
  "–ê–ö–í–ê–ë–ï–ë–°", 
  "–†–ò–§–§–û–¢–í–û–†–ï–¶", 
  "–ì–†–û–ó–ù–ï–ô–ù"
];
const fighterLore = {
  "–í–û–ù–Ø–õ–ö": "–ü–æ–ª—É—á–∏–≤ –ª—å–≥–æ—Ç–Ω—ã–π –∑–∞–π–º –≤ –ô–æ–ª–∫–∏–Ω–±–∞–Ω–∫–µ, —Å—Ç–∞–ª –≤–æ–Ω—é—á–∏–º –º—É—Ç–∞–Ω—Ç–æ–º. –¢–µ–ø–µ—Ä—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏—â–µ—Ç –¥–µ–Ω—å–≥–∏ –≤ –¥–æ–ª–≥ –Ω–∞ –¥—É—à.",
  "–Ø–ù–¢–ê–†–ù–´–ô –®–õ–Ø–•": "–°–≤–µ—Ç–ª—ã–π –∑–∞—â–∏—Ç–Ω–∏–∫ –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥–∞. –ú–æ—â–Ω—ã–π —Å—É–ø–µ—Ä–≥–µ—Ä–æ–π.",
  "–®–õ–Ø–ù": "–ö–æ–≥–¥–∞ –Ø–Ω—Ç–∞—Ä–Ω—ã–π –®–ª—è—Ö –Ω–µ –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ‚Äì –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ–Ω. –®–ª—è–Ω... –¢—å–º–∞ –¥—É—à–∏ –®–ª—è—Ö–æ–≤–∞.",
  "–ë–†–ò–ù–ß 3000": "–°–æ–∑–¥–∞–Ω –≤ TikTok-–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏. –ï–≥–æ –º–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–µ –ó–∞–∫–∞ –¢—Ä–æ–ª–ª–∞.",
  "–ö–ê–ó–ê–•-–ü–ê–£–ö": "–õ–µ–≥–µ–Ω–¥–∞ –∞—É–ª–∞. –°–ø–∞—Å–∞–µ—Ç –≤—Å–µ—Ö, –∏—Å–ø–æ–ª—å–∑—É—è –ø–∞—É—á—å–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏. –õ–µ—Ç–∞–µ—Ç –¥–æ –±–∞–Ω–∫–æ–º–∞—Ç–∞ –Ω–∞ –ø–∞—É—Ç–∏–Ω–µ, —á—Ç–æ–±—ã –∑–∞–¥–æ–Ω–∞—Ç–∏—Ç—å –≤ —Ñ–æ—Ä—Ç.",
  // –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
};


  // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  let gameState = "main-menu"; // main-menu, fighter-select, skin-select, battle, result
  let playerChoice = null;
  let enemyChoice = null;
  let playerSkinIndex = 0;
  let enemySkinIndex = 0;
  let playerHP = 0;
  let enemyHP = 0;
  let playerVSC = 0;
  let enemyVSC = 0;
  let playerMoves = [];
  let enemyMoves = [];
  let towerMode = false;
  let towerLevel = 0;
  let towerEnemyList = [];
  let totalDamageDealt = 0;
  let totalDamageTaken = 0;
  let towerStartTime = 0;
  let isRetry = false;
  let lastTowerEnemy = null;
  let selectedPlayerSprite = ""; // –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
  let playerULTCharge = 0;
  let enemyULTCharge = 0;
  let towerType = "shlyan"; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  let rageTurnsLeft = 0;
  let activeBuffs = {}; // { rage: { turnsLeft: 3, effect: "rage" } }
  let enemyBuffs = {};
  
  const maxULT = 100;
  const mainMenu = document.getElementById("main-menu");
  const fighterSelect = document.getElementById("fighter-select");
  const fighterList = document.getElementById("fighter-list");
  const skinSelect = document.getElementById("skin-select");
  const skinsDiv = document.getElementById("skins");
  const battleDiv = document.getElementById("battle");
  const actionsDiv = document.getElementById("actions");
  const logDiv = document.getElementById("log");
  const resultDiv = document.getElementById("result");
  const resultText = document.getElementById("resultText");
  const statsText = document.getElementById("stats");
  const playerImg = document.getElementById("playerImg");
  const enemyImg = document.getElementById("enemyImg");
  const playerHPBar = document.getElementById("playerHP");
  const enemyHPBar = document.getElementById("enemyHP");
  const playerVSCBar = document.getElementById("playerVSC");
  const enemyVSCBar = document.getElementById("enemyVSC");
  const arena = document.getElementById("arena");

  // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
// –û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –±–∞—à–Ω–∏
document.getElementById("btnCampaign").onclick = () => {
  // –°–∫—Ä—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –±–∞—à–Ω–∏
  document.getElementById('main-menu').style.display = 'none';
  document.getElementById('tower-type-menu').style.display = 'block';
};

// –ö–Ω–æ–ø–∫–∞ –ë–ê–®–ù–Ø –®–õ–Ø–ù–ê
document.getElementById("btnTowerShlyan").onclick = () => {
  // –°—Ç–∞—Ä—Ç –±–∞—à–Ω–∏ –®–ª—è–Ω–∞ (—Ç–≤–æ—è —É–∂–µ –µ—Å—Ç—å)
  towerMode = true;
  towerType = 'shlyan';  // –Ω–æ–≤—ã–π —Ñ–ª–∞–≥, –∫–∞–∫–æ–π —Ä–µ–∂–∏–º –±–∞—à–Ω–∏
  towerLevel = 0;
  towerEnemyList = [];
  totalDamageDealt = 0;
  totalDamageTaken = 0;
  towerStartTime = Date.now();
  document.getElementById('tower-type-menu').style.display = 'none';
  startFighterSelect();
};

// –ö–Ω–æ–ø–∫–∞ –ë–ê–®–ù–Ø –î–û–ö–¢–û–†–ê –ë–£–¢–ê
document.getElementById("btnTowerBut").onclick = () => {
  towerMode = true;
  towerType = 'but';
  towerLevel = 0;
  towerEnemyList = [];
  totalDamageDealt = 0;
  totalDamageTaken = 0;
  towerStartTime = Date.now();
  document.getElementById('tower-type-menu').style.display = 'none';
  startFighterSelect();
};

// –ö–Ω–æ–ø–∫–∞ –ù–ê–ó–ê–î –í –ú–ï–ù–Æ
document.getElementById("btnBackToMain").onclick = () => {
  document.getElementById('tower-type-menu').style.display = 'none';
  document.getElementById('main-menu').style.display = 'block';
};
  document.getElementById("btnQuickFight").onclick = () => {
    startFighterSelect();
  };

  document.getElementById("btnToMenu").onclick = () => {
    showMainMenu();
  };
  document.getElementById("btnReplay").onclick = () => {
  isRetry = true;
  startBattle();
};
  document.getElementById("btnToRoster").onclick = () => {
    startFighterSelect();
  };
  document.getElementById("btnStartTower").onclick = () => {
  document.getElementById("tower-scene").style.display = "none";
  startBattle();
};
document.getElementById("btnRecords").onclick = () => {
  showRecords();
};
  document.getElementById("btnCollection").onclick = () => {
  showCollection();
};
document.getElementById("btnBackFromCollection").onclick = () => {
  document.getElementById("collection").style.display = "none";
  mainMenu.style.display = "block";
};
document.getElementById("btnBackFromRecords").onclick = () => {
  document.getElementById("records").style.display = "none";
  mainMenu.style.display = "block";
};
  // –ó–∞–ø—É—Å–∫–∞–µ–º –≤—ã–±–æ—Ä –±–æ–π—Ü–∞
  function startFighterSelect() {
    gameState = "fighter-select";
    mainMenu.style.display = "none";
    resultDiv.style.display = "none";
    battleDiv.style.display = "none";
    skinSelect.style.display = "none";
    fighterSelect.style.display = "block";
    fighterList.innerHTML = "";

    // –í—ã–≤–æ–¥–∏–º –≤—Å–µ—Ö –±–æ–π—Ü–æ–≤
for (const key in fighters) {
  if (key === "–ê–ë–°–û–õ–Æ–¢–ù–´–ô –®–õ–Ø–ù" || key === "–ê–ë–°–û–õ–Æ–¢–ù–´–ô –ë–£–¢") continue;
  const f = fighters[key];

  const card = document.createElement("div");
card.className = "fighter-card animate-in";
  card.title = key;

  const img = document.createElement("img");
  img.src = f.mini;
  img.alt = key;

  const nameDiv = document.createElement("div");
  nameDiv.className = "fighter-name";
  nameDiv.textContent = key;

  card.appendChild(img);        // <<== –í–°–¢–ê–í–ö–ê –ö–ê–†–¢–ò–ù–ö–ò
  card.appendChild(nameDiv);    // <<== –í–°–¢–ê–í–ö–ê –ù–ê–ó–í–ê–ù–ò–Ø

  card.onclick = () => {
    playerChoice = key;
    startSkinSelect();
  };

  fighterList.appendChild(card);
}
}

  // –í—ã–±–æ—Ä —Å–∫–∏–Ω–∞ –∏–≥—Ä–æ–∫–∞
  function startSkinSelect() {
    gameState = "skin-select";
    fighterSelect.style.display = "none";
    skinSelect.style.display = "block";
    skinsDiv.innerHTML = "";
    selectedPlayerSprite = fighters[playerChoice].sprite[0]; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–µ—Ä–≤—ã–π —Å–∫–∏–Ω
    let skins = [...fighters[playerChoice].sprite]; // –∫–æ–ø–∏—è

const unlockedTowerSkins = JSON.parse(localStorage.getItem("towerSkins") || "{}");
if (unlockedTowerSkins["–±–∞—à–Ω—è"]?.[playerChoice]) {
  skins.push(`${playerChoice.toLowerCase()}_–±–∞—à–Ω—è.png`);
}
if (unlockedTowerSkins["–±—É—Ç–±–æ—Ç—ã"]?.[playerChoice]) {
  skins.push(`${playerChoice.toLowerCase()}_–±—É—Ç–±–æ—Ç—ã.png`);
}
    playerSkinIndex = 0;
// –¥–æ–±–∞–≤–ª—è–µ–º —Å–∫–∏–Ω –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞, –µ—Å–ª–∏ –∫—É–ø–ª–µ–Ω
const shopSkins = JSON.parse(localStorage.getItem("shopSkins") || "{}");
const shopPath = `${playerChoice.toLowerCase()}_–º–∞–≥–∞–∑–∏–Ω.png`;
if (shopSkins[playerChoice]) {
  skins.push(shopPath);
}
    for(let i=0; i<skins.length; i++) {
      const img = document.createElement("img");
      img.src = skins[i];
      img.style.width = "80px";
      img.style.margin = "0 5px";
      img.style.cursor = "pointer";
      img.title = `–°–∫–∏–Ω ${i+1}`;
      if(i===playerSkinIndex) img.style.border = "3px solid cyan";
      if (skins[i].includes("_–±–∞—à–Ω—è")) img.classList.add("tower-skin");
if (skins[i].includes("_–±—É—Ç–±–æ—Ç—ã")) img.classList.add("butbot-skin");
if (skins[i].includes("_–º–∞–≥–∞–∑–∏–Ω")) {
  img.classList.add("shop-skin");
}
      img.onclick = () => {
  playerSkinIndex = i;
  selectedPlayerSprite = skins[i]; // üí• —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ
  updateSkinSelection();
};
if (skins[i].includes("_–±—É—Ç–±–æ—Ç—ã")) {
  img.classList.add("butbot-skin");
}
      skinsDiv.appendChild(img);
    }

    const startBtn = document.createElement("button");
    startBtn.textContent = "–ù–∞—á–∞—Ç—å –±–æ–π!";
    startBtn.onclick = () => {
  selectedPlayerSprite = skins[playerSkinIndex];
  if (towerMode) {
    showTowerScene();
  } else {
    startBattle();
  }
};
    skinsDiv.appendChild(startBtn);
  }

  function updateSkinSelection() {
    const imgs = skinsDiv.querySelectorAll("img");
    imgs.forEach((img, idx) => {
      img.style.border = (idx === playerSkinIndex) ? "3px solid cyan" : "none";
    });
  }
  function applyEnemyBuff(buffName, duration) {
  enemyBuffs[buffName] = { turnsLeft: duration };

  if (buffName === "rage") {
    logDiv.textContent = `${enemyChoice} –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –°–´–í–û–†–û–¢–ö–£! –ï–≥–æ –∞—Ç–∞–∫–∏ —É—Å–∏–ª–µ–Ω—ã!`;
    enemyImg.classList.add("rage-glow");
  }

  // –¥–æ–±–∞–≤–∏–º –¥—Ä—É–≥–∏–µ –±–∞—Ñ—Ñ—ã –ø–æ–∑–∂–µ
}
  function applyBuff(buffName, duration) {
  activeBuffs[buffName] = { turnsLeft: duration };
 // –ë–ê–§–§–´
  if (buffName === "rage") {
    logDiv.textContent = "üß™ –ì—Ä–æ–∑–Ω–µ–π–Ω –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –°–´–í–û–†–û–¢–ö–£! –ê—Ç–∞–∫–∏ —É—Å–∏–ª–µ–Ω—ã!";
    playerImg.classList.add("rage-glow");
  }

  // –¢—É—Ç –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö –±–∞—Ñ—Ñ–æ–≤
}
function updateBuffs() {
  for (const buff in activeBuffs) {
    activeBuffs[buff].turnsLeft--;
    if (activeBuffs[buff].turnsLeft <= 0) {
      // –ò—Å—Ç—ë–∫ —ç—Ñ—Ñ–µ–∫—Ç
      delete activeBuffs[buff];
      if (buff === "rage") {
        playerImg.classList.remove("rage-glow");
        logDiv.textContent += " ‚ö†Ô∏è –≠—Ñ—Ñ–µ–∫—Ç –°–´–í–û–†–û–¢–ö–ò –∑–∞–∫–æ–Ω—á–∏–ª—Å—è.";
      }

      // –í –±—É–¥—É—â–µ–º: –¥—Ä—É–≥–∏–µ —Å–Ω—è—Ç–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
    }
  }
}
function updateEnemyBuffs() {
  for (const buff in enemyBuffs) {
    enemyBuffs[buff].turnsLeft--;
    if (enemyBuffs[buff].turnsLeft <= 0) {
      delete enemyBuffs[buff];
      if (buff === "rage") {
        enemyImg.classList.remove("rage-glow");
        logDiv.textContent += ` ‚ö†Ô∏è –≠—Ñ—Ñ–µ–∫—Ç –°–´–í–û–†–û–¢–ö–ò —É ${enemyChoice} –∑–∞–∫–æ–Ω—á–∏–ª—Å—è.`;
      }
    }
  }
}
  // –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ–π
  function startBattle() {
 
  	playerImg.classList.remove("fade-out");
enemyImg.classList.remove("fade-out");
    skinSelect.style.display = "none";
battleDiv.style.display = "block";
resultDiv.style.display = "none";
    document.getElementById("towerProgress").style.display = "none";
mainMenu.style.display = "none";
fighterSelect.style.display = "none";
    gameState = "battle";
    enemyBuffs = {};
enemyImg.classList.remove("rage-glow");
    activeBuffs = {}; // —Å–±—Ä–æ—Å –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∞—Ñ—Ñ–æ–≤
playerImg.classList.remove("rage-glow"); // —É–±–∏—Ä–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
    skinSelect.style.display = "none";
    battleDiv.style.display = "block";
    if (towerMode) {
  document.getElementById("towerProgress").style.display = "block";
  document.getElementById("towerProgress").textContent = `–ë–∞—à–Ω—è ‚Äî –ë–æ–π ${towerLevel + 1} –∏–∑ 5`;
} else {
  document.getElementById("towerProgress").style.display = "none";
}
activeBuffs = {};
playerImg.classList.remove("rage-glow");
    logDiv.textContent = "";

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –•–ü –∏ –í–°–ö
 enemyImg.style.transform = "scaleX(-1)";
    playerHP = fighters[playerChoice].hpMax;
    playerVSC = fighters[playerChoice].vscMax;
    playerMoves = fighters[playerChoice].moves;

    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—Ä–∞–≥–∞
if (towerMode) {
	if (towerType === "shlyan") {
  if (isRetry && lastTowerEnemy) {
    // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –±–æ–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–≥–æ –∂–µ –≤—Ä–∞–≥–∞
    enemyChoice = lastTowerEnemy;
  } else {
    if (towerLevel < 4) {
      const keys = Object.keys(fighters).filter(k =>
        k !== playerChoice &&
        !towerEnemyList.includes(k) &&
        k !== "–®–õ–Ø–ù" && k!== "–ê–ë–°–û–õ–Æ–¢–ù–´–ô –®–õ–Ø–ù" && k!== "–Ø–ù–¢–ê–†–ù–´–ô –®–õ–Ø–•"
        && k!== "–ê–ë–°–û–õ–Æ–¢–ù–´–ô –ë–£–¢"
      );
      enemyChoice = keys[Math.floor(Math.random() * keys.length)];
      towerEnemyList.push(enemyChoice);
    } else {
      enemyChoice = "–ê–ë–°–û–õ–Æ–¢–ù–´–ô –®–õ–Ø–ù"; // —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–æ—Å—Å
    }
    lastTowerEnemy = enemyChoice; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–∞–≥–∞ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–∞
  }
  }
  else if (towerType === 'but') {
    if (isRetry && lastTowerEnemy) {
      enemyChoice = lastTowerEnemy;
    } else {
      if (towerLevel < 5) {
        if (towerLevel < 5 - 2) {
          // –ø–µ—Ä–≤—ã–µ 5 –≤—Ä–∞–≥–æ–≤ ‚Äî 5 —Å–ª—É—á–∞–π–Ω—ã—Ö
          const keys = Object.keys(fighters).filter(k =>
            k !== playerChoice &&
            !towerEnemyList.includes(k) &&
            k !== '–î–û–ö–¢–û–† –ë–£–¢' && k !== '–ê–ë–°–û–õ–Æ–¢–ù–´–ô –ë–£–¢' && k!== '–ê–ë–°–û–õ–Æ–¢–ù–´–ô –®–õ–Ø–ù'
          );
          enemyChoice = keys[Math.floor(Math.random() * keys.length)];
          towerEnemyList.push(enemyChoice);
        } else if (towerLevel === 3) {
          enemyChoice = '–î–û–ö–¢–û–† –ë–£–¢';
        } else {
          enemyChoice = '–ê–ë–°–û–õ–Æ–¢–ù–´–ô –ë–£–¢';
        }
        lastTowerEnemy = enemyChoice;
      }
    }
  }

} else {
  const keys = Object.keys(fighters).filter(k => k !== playerChoice !== "–ê–ë–°–û–õ–Æ–¢–ù–´–ô –®–õ–Ø–ù" !== "–ê–ë–°–û–õ–Æ–¢–ù–´–ô –ë–£–¢");
  enemyChoice = keys[Math.floor(Math.random() * keys.length)];
}
    enemySkinIndex = 0;
    enemyHP = fighters[enemyChoice].hpMax;
    enemyVSC = fighters[enemyChoice].vscMax;
    enemyMoves = fighters[enemyChoice].moves;
enemyImg.classList.remove("boss-glow"); // –î–û —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤–æ–≥–æ —Å–ø—Ä–∞–π—Ç–∞
    updateUI();
if (towerMode && towerLevel === 4) {
  enemyImg.classList.add("boss-glow");
  enemyImg.title = "üëë –§–∏–Ω–∞–ª—å–Ω—ã–π –ë–æ—Å—Å";
}
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ø—Ä–∞–π—Ç—ã
    playerImg.src = selectedPlayerSprite;
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞—à–µ–Ω–Ω–æ–≥–æ —Å–∫–∏–Ω–∞ –¥–ª—è –≤—Ä–∞–≥–∞
const unlockedTowerSkins = JSON.parse(localStorage.getItem("towerSkins") || "{}");
const enemyBaseSprites = fighters[enemyChoice].sprite;
let towerSkinPath;
if (towerType === 'shlyan') {
  towerSkinPath = `${enemyChoice.toLowerCase()}_–±–∞—à–Ω—è.png`;
} else if (towerType === 'but') {
  towerSkinPath = `${enemyChoice.toLowerCase()}_–±—É—Ç–±–æ—Ç—ã.png`;
}
enemyImg.src = towerSkinPath;

if (towerMode) {
  enemyImg.src = towerSkinPath;
} else {
  enemyImg.src = enemyBaseSprites[enemySkinIndex];
}
// –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–π –∞—Ä–µ–Ω—ã
const arenaCount = 9; // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä–µ–Ω–Ω—ã—Ö —Ñ–æ–Ω–æ–≤
const arenaIndex = Math.floor(Math.random() * arenaCount) + 1;
arena.style.backgroundImage = `url('arena${arenaIndex}.png')`;
arena.classList.remove("arena-animate"); // —Å–±—Ä–æ—Å –µ—Å–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ
void arena.offsetWidth; // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
arena.classList.add("arena-animate");
// –ü–æ–∫–∞–∑–∞—Ç—å faceoff-—Å—Ü–µ–Ω—É –ø–µ—Ä–µ–¥ –±–æ–µ–º
document.getElementById("battle").style.display = "none";
document.getElementById("faceoff-player").src = selectedPlayerSprite;
document.getElementById("faceoff-enemy").src = fighters[enemyChoice].sprite[0]; // –±–∞–∑–æ–≤—ã–π —Å–ø—Ä–∞–π—Ç –≤—Ä–∞–≥–∞
document.getElementById("faceoff-player").style.transform = "scaleX(1)";
document.getElementById("faceoff-enemy").style.transform = "scaleX(-1)";
document.getElementById("faceoff-scene").style.display = "flex";

// –ü–æ–¥–æ–∂–¥–∞—Ç—å 2 —Å–µ–∫—É–Ω–¥—ã –∏ –Ω–∞—á–∞—Ç—å –±–æ–π
setTimeout(() => {
  document.getElementById("faceoff-scene").style.display = "none";
  document.getElementById("battle").style.display = "block";
  beginFight();
}, 2000);
return; // –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è faceoff-—Å—Ü–µ–Ω—ã
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞
    showActions();
    isRetry = false;
  }

function beginFight() {
  if (towerMode) {
    document.getElementById("towerProgress").style.display = "block";
    document.getElementById("towerProgress").textContent = `–ë–∞—à–Ω—è ‚Äî –ë–æ–π ${towerLevel + 1} –∏–∑ 5`;
  } else {
    document.getElementById("towerProgress").style.display = "none";
  }
  enemyBuffs = {};
enemyImg.classList.remove("rage-glow");
 activeBuffs = {};
playerImg.classList.remove("rage-glow");
  logDiv.textContent = "";
  enemyImg.style.transform = "scaleX(-1)";
  playerHP = fighters[playerChoice].hpMax;
  playerVSC = fighters[playerChoice].vscMax;
  playerMoves = fighters[playerChoice].moves;

  enemySkinIndex = 0;
  enemyHP = fighters[enemyChoice].hpMax;
  enemyVSC = fighters[enemyChoice].vscMax;
  enemyMoves = fighters[enemyChoice].moves;

  enemyImg.classList.remove("boss-glow");

  playerImg.src = selectedPlayerSprite;
  const enemyBaseSprites = fighters[enemyChoice].sprite;
  let towerSkinPath;
  if (towerType === 'shlyan') towerSkinPath = `${enemyChoice.toLowerCase()}_–±–∞—à–Ω—è.png`;
  else if (towerType === 'but') towerSkinPath = `${enemyChoice.toLowerCase()}_–±—É—Ç–±–æ—Ç—ã.png`;

  if (towerMode) enemyImg.src = towerSkinPath;
  else enemyImg.src = enemyBaseSprites[enemySkinIndex];

  if (towerMode && towerLevel === 4) {
    enemyImg.classList.add("boss-glow");
    enemyImg.title = "üëë –§–∏–Ω–∞–ª—å–Ω—ã–π –ë–æ—Å—Å";
  }

  // –°–ª—É—á–∞–π–Ω–∞—è –∞—Ä–µ–Ω–∞
  const arenaCount = 9;
  const arenaIndex = Math.floor(Math.random() * arenaCount) + 1;
  arena.style.backgroundImage = `url('arena${arenaIndex}.png')`;
  arena.classList.remove("arena-animate");
  void arena.offsetWidth;
  arena.classList.add("arena-animate");

  showActions();
  isRetry = false;
  updateUI();
}
  function updateUI() {
    playerHPBar.style.width = (playerHP / fighters[playerChoice].hpMax * 100) + "%";
    enemyHPBar.style.width = (enemyHP / fighters[enemyChoice].hpMax * 100) + "%";
    playerVSCBar.style.width = (playerVSC / fighters[playerChoice].vscMax * 100) + "%";
    enemyVSCBar.style.width = (enemyVSC / fighters[enemyChoice].vscMax * 100) + "%";
  }

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –∏–≥—Ä–æ–∫–∞
  function showActions() {
  actionsDiv.innerHTML = "";
  playerMoves.forEach((move, idx) => {
    const btn = document.createElement("button");
    btn.textContent = `${move.name} (${move.cost ? move.cost + " –í–°–ö" : "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ"})`;
    btn.disabled = move.cost > playerVSC;
    btn.classList.add("action-button-animate"); // üî• –∞–Ω–∏–º–∞—Ü–∏—è!
    btn.onclick = () => {
      playerTurn(idx);
    };
    actionsDiv.appendChild(btn);
  });

  }

  // –•–æ–¥ –∏–≥—Ä–æ–∫–∞
  function showDamage(targetEl, dmg, isCrit = false) {
  const dmgEl = document.createElement("div");
  dmgEl.className = "damage-popup";

  // –ï—Å–ª–∏ —É —Ä–æ–¥–∏—Ç–µ–ª—è –µ—Å—Ç—å –∫–ª–∞—Å—Å 'flipped', –¥–æ–±–∞–≤–ª—è–µ–º no-flip
  if (targetEl.classList.contains("flipped")) {
    dmgEl.classList.add("no-flip");
  }

  dmgEl.textContent = `-${dmg}${isCrit ? " üî•" : ""}`;
  targetEl.appendChild(dmgEl);
  setTimeout(() => dmgEl.remove(), 800);
}

function flash(el) {
  el.classList.add("flash-hit");
  setTimeout(() => el.classList.remove("flash-hit"), 300);
}
  function playerTurn(moveIdx) {
  const move = playerMoves[moveIdx];
  if (move.buff) {
  applyBuff(move.buff, move.duration || 3);
  playerVSC = Math.min(playerVSC + 10, fighters[playerChoice].vscMax);
  updateUI();
  actionsDiv.innerHTML = ""; // ‚¨ÖÔ∏è –í–ê–ñ–ù–û!
  setTimeout(enemyTurn, 1000);
  return;
}
  if (move.cost > playerVSC) return;

  let isCrit = false;
  let finalDmg = move.dmg;
  if (activeBuffs["rage"]) {
  finalDmg = Math.floor(finalDmg * 1.35); // —É—Å–∏–ª–µ–Ω–∏–µ —É—Ä–æ–Ω–∞
}
  // üéØ –®–∞–Ω—Å –ø—Ä–æ–º–∞—Ö–∞ –∏–≥—Ä–æ–∫–∞ 15%
if (move.dmg && Math.random() < 0.15) {
  logDiv.textContent = `–ò–≥—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ${move.name}, –Ω–æ –ü–†–û–ú–ê–•–ò–í–ê–ï–¢–°–Ø!`;
  playerVSC -= move.cost;
  playerVSC = Math.max(0, playerVSC);
  updateUI();
  actionsDiv.innerHTML = ""; // ‚¨ÖÔ∏è –î–æ–±–∞–≤–ª—è–µ–º!
  setTimeout(enemyTurn, 1000);
  return;
}
  if (move.dmg) {
    if (Math.random() < 0.2) { // 20% —à–∞–Ω—Å
      isCrit = true;
      finalDmg = Math.floor(move.dmg * 1.5);
    }
   
    enemyHP -= finalDmg;
    totalDamageDealt += finalDmg;
    logDiv.textContent = `–ò–≥—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ${move.name} –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${finalDmg} —É—Ä–æ–Ω–∞!${isCrit ? " üî• –ö—Ä–∏—Ç!" : ""}`;
    showDamage(enemyImg.parentElement, finalDmg, isCrit); // ‚úÖ –ø–µ—Ä–µ–¥–∞—ë–º isCrit
    flash(enemyImg);
  }

  if (move.restore) {
    playerVSC += move.restore;
    if (playerVSC > fighters[playerChoice].vscMax) playerVSC = fighters[playerChoice].vscMax;
    logDiv.textContent = `–ò–≥—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ${move.name} –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ${move.restore} –í–°–ö!`;
  }

  playerVSC -= move.cost;
  if (playerVSC < 0) playerVSC = 0;

  if (enemyHP <= 0) {
  enemyHP = 0;
  updateUI();
  enemyImg.classList.add("fade-out"); // üí•
  setTimeout(() => endBattle(true), 700); // –ø–æ–¥–æ–∂–¥—ë–º –∞–Ω–∏–º–∞—Ü–∏—é
  return;
}

  updateUI();
  actionsDiv.innerHTML = "";
  updateBuffs();
  playerVSC = Math.min(playerVSC + 10, fighters[playerChoice].vscMax);
  setTimeout(enemyTurn, 1000);
}
  // –•–æ–¥ –≤—Ä–∞–≥–∞ ‚Äî –≤—ã–±–∏—Ä–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–π —Ö–æ–¥ —Å–ª—É—á–∞–π–Ω–æ
  function enemyTurn() {
  let move;
  const available = enemyMoves.filter(m => m.cost <= enemyVSC);
  const lowHP = enemyHP <= fighters[enemyChoice].hpMax * 0.3;
  const playerLow = playerHP <= fighters[playerChoice].hpMax * 0.3;

  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –µ—Å–ª–∏ —Ö–∏–ª –Ω—É–∂–µ–Ω –∏ –µ—Å—Ç—å —Ö–∏–ª
  if (lowHP) {
    const heal = enemyMoves.find(m => m.restore && m.cost <= enemyVSC);
    if (heal) {
      move = heal;
    }
  }

  // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –µ—Å–ª–∏ –º–æ–∂–Ω–æ –¥–æ–±–∏—Ç—å –∏–≥—Ä–æ–∫–∞ ‚Äî –±–µ–π —Å–∏–ª—å–Ω–æ
  if (!move && playerLow) {
    const finisher = available.find(m => m.dmg >= playerHP);
    if (finisher) move = finisher;
  }

  // –ï—Å–ª–∏ –µ—Å—Ç—å rage-–±–∞—Ñ—Ñ –∏ –æ–Ω –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–π
  if (!move) {
    const rage = enemyMoves.find(m => m.buff === "rage" && !enemyBuffs["rage"] && m.cost <= enemyVSC);
    if (rage) move = rage;
  }

  // –°–∏–ª—å–Ω—ã–π —É–¥–∞—Ä, –µ—Å–ª–∏ —Ö–≤–∞—Ç–∞–µ—Ç –í–°–ö
  if (!move) {
    const heavy = available.filter(m => m.dmg).sort((a, b) => b.dmg - a.dmg)[0];
    if (heavy) move = heavy;
  }

  // –ï—Å–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ—á–µ–≥–æ –¥–µ–ª–∞—Ç—å ‚Äî —Ö–∏–ª –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
  if (!move) {
    move = enemyMoves.find(m => m.restore);
    if (!move) {
      logDiv.textContent = `${enemyChoice} –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥, –Ω–µ—Ç –í–°–ö.`;
      setTimeout(showActions, 1000);
      return;
    }
  }

  executeEnemyMove(move);
}
function executeEnemyMove(move) {
  let isCrit = false;
  let finalDmg = move.dmg;
  if (enemyBuffs["rage"]) {
    finalDmg = Math.floor(finalDmg * 1.35);
  }

  // –ü–†–û–ú–ê–•
  if (move.dmg && Math.random() < 0.15) {
    logDiv.textContent = `${enemyChoice} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ${move.name}, –Ω–æ –ü–†–û–ú–ê–•–ò–í–ê–ï–¢–°–Ø!`;
    enemyVSC -= move.cost;
    enemyVSC = Math.max(0, enemyVSC);
    updateUI();
    setTimeout(() => {
      logDiv.textContent = "";
      enemyVSC = Math.min(enemyVSC + 10, fighters[enemyChoice].vscMax);
      showActions();
    }, 1000);
    return;
  }

  // –ë–ê–§–§
  if (move.buff) {
    applyEnemyBuff(move.buff, move.duration || 3);
    enemyVSC -= move.cost;
    updateUI();
    setTimeout(() => {
      logDiv.textContent = "";
      enemyVSC = Math.min(enemyVSC + 10, fighters[enemyChoice].vscMax);
      showActions();
    }, 1000);
    return;
  }

  // –ê–¢–ê–ö–ê
  if (move.dmg) {
    if (Math.random() < 0.2) {
      isCrit = true;
      finalDmg = Math.floor(move.dmg * 1.5);
    }
    playerHP -= finalDmg;
    totalDamageTaken += finalDmg;
    logDiv.textContent = `${enemyChoice} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ${move.name} –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${finalDmg} —É—Ä–æ–Ω–∞!${isCrit ? " üî• –ö—Ä–∏—Ç!" : ""}`;
    showDamage(playerImg.parentElement, finalDmg, isCrit);
    flash(playerImg);
  }

  if (move.restore) {
    enemyVSC += move.restore;
    if (enemyVSC > fighters[enemyChoice].vscMax) enemyVSC = fighters[enemyChoice].vscMax;
    logDiv.textContent = `${enemyChoice} –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ${move.name} –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ${move.restore} –í–°–ö!`;
  }

  enemyVSC -= move.cost;
  if (enemyVSC < 0) enemyVSC = 0;

  if (playerHP <= 0) {
    playerHP = 0;
    updateUI();
    playerImg.classList.add("fade-out");
    setTimeout(() => endBattle(false), 700);
    return;
  }

  updateUI();
  updateEnemyBuffs();
  setTimeout(() => {
    logDiv.textContent = "";
    enemyVSC = Math.min(enemyVSC + 10, fighters[enemyChoice].vscMax);
    showActions();
  }, 1000);
}
  // –ö–æ–Ω–µ—Ü –±–æ—è
  function endBattle(playerWon) {
  updateUI();
  if (towerMode && playerWon && towerLevel < 4) {
    towerLevel++;
    setTimeout(startBattle, 1500);
    return;
  }

  gameState = "result";
  battleDiv.style.display = "none";
  resultDiv.style.display = "block";

  if (towerMode && playerWon && towerLevel === 4) {
  // –ü–æ–±–µ–¥–∞ –≤ –±–∞—à–Ω–µ
  addCoins(50);
  const durationSec = Math.floor((Date.now() - towerStartTime) / 1000);
  resultText.innerHTML = `
  <div style="position:relative; display:inline-block;">
    <div style="position:absolute; top:-30px; width:100%; text-align:center; font-size:22px; font-weight:bold; color:gold; text-shadow:1px 1px 3px #000;">–ü–û–ë–ï–î–ò–¢–ï–õ–¨</div>
    <img src="${selectedPlayerSprite}" style="width:150px;"/>
  </div>
`;
  statsText.innerHTML = `
    –ì–µ—Ä–æ–π: <strong>${playerChoice}</strong><br>
    –í—Ä–µ–º—è: <strong>${durationSec} —Å–µ–∫</strong><br>
    –£—Ä–æ–Ω –Ω–∞–Ω–µ—Å—ë–Ω: <strong>${totalDamageDealt}</strong><br>
    –£—Ä–æ–Ω –ø–æ–ª—É—á–µ–Ω: <strong>${totalDamageTaken}</strong><br>
    –ü–æ–ª—É—á–µ–Ω–æ <strong>50 –º–æ–Ω–µ—Ç!</strong>
  `;
// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∫–æ—Ä–¥
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞—à–µ–Ω–Ω—ã–π —Å–∫–∏–Ω
let unlockedTowerSkins = JSON.parse(localStorage.getItem("towerSkins") || "{}");
if (!unlockedTowerSkins["–±–∞—à–Ω—è"]) unlockedTowerSkins["–±–∞—à–Ω—è"] = {};
if (!unlockedTowerSkins["–±—É—Ç–±–æ—Ç—ã"]) unlockedTowerSkins["–±—É—Ç–±–æ—Ç—ã"] = {};

if (towerType === "shlyan") {
  unlockedTowerSkins["–±–∞—à–Ω—è"][playerChoice] = true;
}
if (towerType === "but") {
  unlockedTowerSkins["–±—É—Ç–±–æ—Ç—ã"][playerChoice] = true;
}
localStorage.setItem("towerSkins", JSON.stringify(unlockedTowerSkins));
const record = {
  hero: playerChoice,
  skin: selectedPlayerSprite,
  time: durationSec,
  damageDealt: totalDamageDealt,
  damageTaken: totalDamageTaken,
  date: new Date().toLocaleDateString()
};
let records = JSON.parse(localStorage.getItem("towerRecords") || "[]");
records.push(record);
records.sort((a, b) => a.time - b.time); // –±—ã—Å—Ç—Ä–µ–µ ‚Äî –ª—É—á—à–µ
records = records.slice(0, 10); // –º–∞–∫—Å–∏–º—É–º 10 —Ä–µ–∫–æ—Ä–¥–æ–≤
localStorage.setItem("towerRecords", JSON.stringify(records));
  towerMode = false; // –±–∞—à–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Ç–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å
} else {
  resultText.textContent = playerWon ? "–í—ã –ø–æ–±–µ–¥–∏–ª–∏!" : "–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!";
  statsText.textContent =
    `–ò–≥—Ä–æ–∫ (${playerChoice}) HP: ${playerHP}/${fighters[playerChoice].hpMax}, –í–°–ö: ${playerVSC}/${fighters[playerChoice].vscMax}\n` +
    `–í—Ä–∞–≥ (${enemyChoice}) HP: ${enemyHP}/${fighters[enemyChoice].hpMax}, –í–°–ö: ${enemyVSC}/${fighters[enemyChoice].vscMax}`;

  // –í–∞–∂–Ω–æ: towerMode –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è –ø–æ–±–µ–¥–∞
  if (!towerMode) {
    // –µ—Å–ª–∏ —ç—Ç–æ –æ–±—ã—á–Ω—ã–π –±—ã—Å—Ç—Ä—ã–π –±–æ–π ‚Äî –º–æ–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å
    towerMode = false;
  }
}
  }
    
  // –ë–ê–®–ù–Ø
  function showTowerScene() {
  console.log("–°–ü–†–ê–ô–¢ –î–õ–Ø –°–¶–ï–ù–´:", selectedPlayerSprite); // üí• –í–ê–ñ–ù–û
const txt = document.getElementById("sceneText");
txt.classList.remove("tower-text-animate"); // —Å–±—Ä–æ—Å
void txt.offsetWidth; // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
txt.classList.add("tower-text-animate");
// txt.style.border = "1px dashed red"; // üí• —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ —É–≤–∏–¥–µ—Ç—å
  document.getElementById("main-menu").style.display = "none";
  document.getElementById("skin-select").style.display = "none";
  document.getElementById("tower-scene").style.display = "block";

  const playerSceneImg = document.getElementById("scenePlayer");
  playerSceneImg.src = selectedPlayerSprite;
  const towerImg = document.getElementById("sceneTower");
const sceneText = document.getElementById("sceneText");

// –ú–µ–Ω—è–µ–º –±–∞—à–Ω—é –∏ —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –±–∞—à–Ω–∏
if (towerType === "but") {
  towerImg.src = "buttower.png"; // –ö–ê–†–¢–ò–ù–ö–ê –±–∞—à–Ω–∏ –î–û–ö–¢–û–†–ê –ë–£–¢–ê (–ø–æ–ª–æ–∂–∏ –≤ –∫–æ—Ä–µ–Ω—å)
  sceneText.innerHTML = `
    <div style="font-weight:bold; font-size:22px;">–ë–∞—à–Ω—è –ë—É—Ç–∞ –∂–¥—ë—Ç...</div>
    <div style="margin-top:10px;">–°–º–µ–ª –ª–∏ —Ç—ã –±—Ä–æ—Å–∏—Ç—å –≤—ã–∑–æ–≤ –ê–ë–°–û–õ–Æ–¢–ù–û–ú–£ –ë–£–¢–£?</div>
  `;
} else {
  towerImg.src = "tower.png"; // —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∞—à–Ω—è
  sceneText.innerHTML = `
    <div style="font-weight:bold; font-size:22px;">–ë–∞—à–Ω—è –∂–¥—ë—Ç...</div>
    <div style="margin-top:10px;">–¢—ã –≥–æ—Ç–æ–≤ –ø—Ä–æ–π—Ç–∏ –ø—É—Ç—å –¥–æ –≤–µ—Ä—à–∏–Ω—ã –∏ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –ê–ë–°–û–õ–Æ–¢–ù–´–ú –®–õ–Ø–ù–û–ú?</div>
  `;
}
}

// –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ
  function showMainMenu() {
    gameState = "main-menu";
    resultDiv.style.display = "none";
    battleDiv.style.display = "none";
    skinSelect.style.display = "none";
    fighterSelect.style.display = "none";
    mainMenu.style.display = "block";
  }
function showRecords() {
  const recordsDiv = document.getElementById("records");
  const list = document.getElementById("recordsList");
  mainMenu.style.display = "none";
  recordsDiv.style.display = "block";

  const records = JSON.parse(localStorage.getItem("towerRecords") || "[]");
  if (records.length === 0) {
    list.innerHTML = "<p>–†–µ–∫–æ—Ä–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>";
    return;
  }

  list.innerHTML = records.map((r, i) => `
    <div style="margin-bottom:10px; text-align:left; background:#222; padding:10px; border-radius:10px;">
      <strong>#${i + 1}</strong> ‚Äî <img src="${r.skin}" style="width:30px; vertical-align:middle;"/> <strong>${r.hero}</strong><br/>
      –í—Ä–µ–º—è: <strong>${r.time} —Å–µ–∫</strong><br/>
      –£—Ä–æ–Ω: <span style="color:lime">${r.damageDealt}</span> / <span style="color:red">${r.damageTaken}</span><br/>
      –î–∞—Ç–∞: ${r.date}
    </div>
  `).join("");
}
  function showCollection() {
  const unlockedSkins = JSON.parse(localStorage.getItem("towerSkins") || "{}");
  if (!unlockedSkins["–±–∞—à–Ω—è"]) unlockedSkins["–±–∞—à–Ω—è"] = {};
  if (!unlockedSkins["–±—É—Ç–±–æ—Ç—ã"]) unlockedSkins["–±—É—Ç–±–æ—Ç—ã"] = {};

  const container = document.getElementById("collectionList");
  container.innerHTML = "";
  mainMenu.style.display = "none";
  document.getElementById("collection").style.display = "block";

  for (const fighter in fighters) {
    if (fighter === "–ê–ë–°–û–õ–Æ–¢–ù–´–ô –®–õ–Ø–ù" || fighter === "–ê–ë–°–û–õ–Æ–¢–ù–´–ô –ë–£–¢") continue;

    const card = document.createElement("div");
    card.className = "collection-card";

    const title = document.createElement("div");
    title.className = "collection-card-title";
    title.textContent = fighter;

    const skinContainer = document.createElement("div");
    skinContainer.className = "collection-skins";

    // –û–±—ã—á–Ω—ã–µ —Å–∫–∏–Ω—ã
    fighters[fighter].sprite.forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      img.title = "–û–±—ã—á–Ω—ã–π —Å–∫–∏–Ω";
      skinContainer.appendChild(img);
    });

    // –ë–∞—à–Ω—è –®–õ–Ø–ù–ê
    const towerSkin = document.createElement("img");
    towerSkin.src = `${fighter.toLowerCase()}_–±–∞—à–Ω—è.png`;
    if (unlockedSkins["–±–∞—à–Ω—è"]?.[fighter]) {
      towerSkin.classList.add("unlocked-skin", "tower-skin");
      towerSkin.title = "–°–∫–∏–Ω –∑–∞ –ø–æ–±–µ–¥—É –≤ –±–∞—à–Ω–µ –®–ª—è–Ω–∞";
    } else {
      towerSkin.classList.add("locked-skin");
      towerSkin.title = "–°–∫–∏–Ω –∑–∞ –ø–æ–±–µ–¥—É –≤ –±–∞—à–Ω–µ –®–ª—è–Ω–∞ (–Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)";
    }
    skinContainer.appendChild(towerSkin);

    // –ë–∞—à–Ω—è –î–û–ö–¢–û–†–ê –ë–£–¢–ê
    const butSkin = document.createElement("img");
    butSkin.src = `${fighter.toLowerCase()}_–±—É—Ç–±–æ—Ç—ã.png`;
    if (unlockedSkins["–±—É—Ç–±–æ—Ç—ã"]?.[fighter]) {
      butSkin.classList.add("unlocked-skin", "butbot-skin");
      butSkin.title = "–°–∫–∏–Ω –∑–∞ –ø–æ–±–µ–¥—É –≤ –±–∞—à–Ω–µ –î–æ–∫—Ç–æ—Ä–∞ –ë—É—Ç–∞";
    } else {
      butSkin.classList.add("locked-skin");
      butSkin.title = "–°–∫–∏–Ω –∑–∞ –ø–æ–±–µ–¥—É –≤ –±–∞—à–Ω–µ –î–æ–∫—Ç–æ—Ä–∞ –ë—É—Ç–∞ (–Ω–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)";
    }
    skinContainer.appendChild(butSkin);
// –ú–∞–≥–∞–∑–∏–Ω–Ω—ã–π —Å–∫–∏–Ω
if (shopSkinAvailable.includes(fighter)) {
  const shopSkin = document.createElement("img");
  shopSkin.src = `${fighter.toLowerCase()}_–º–∞–≥–∞–∑–∏–Ω.png`;
  if (JSON.parse(localStorage.getItem("shopSkins") || "{}")[fighter]) {
    shopSkin.classList.add("unlocked-skin", "shop-skin");
    shopSkin.title = "–ö—É–ø–ª–µ–Ω–Ω—ã–π —Å–∫–∏–Ω –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞";
  } else {
    shopSkin.classList.add("locked-skin");
    shopSkin.title = "–°–∫–∏–Ω –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ (–Ω–µ –∫—É–ø–ª–µ–Ω)";
  }
  skinContainer.appendChild(shopSkin);
}
    card.appendChild(title);
    card.appendChild(skinContainer);
    card.onclick = () => {
  document.getElementById("loreTitle").textContent = fighter;
  document.getElementById("loreText").textContent = fighterLore[fighter] || "–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ —Å–∫—Ä—ã—Ç–∞...";
  document.getElementById("loreModal").style.display = "flex";
};
    container.appendChild(card);
  }
}
// ========== –ú–û–ù–ï–¢–´ ==========
function getCoins() {
  return parseInt(localStorage.getItem("coins") || "0");
}
function setCoins(value) {
  localStorage.setItem("coins", value);
}
function addCoins(amount) {
  setCoins(getCoins() + amount);
}

// ========== –ú–ê–ì–ê–ó–ò–ù ==========
document.getElementById("btnShop").onclick = () => {
  showShop();
};
document.getElementById("btnBackFromShop").onclick = () => {
  document.getElementById("shop").style.display = "none";
  mainMenu.style.display = "block";
};

function showShop() {
  const container = document.getElementById("shopList");
  const coinCount = document.getElementById("coinCount");
  mainMenu.style.display = "none";
  document.getElementById("shop").style.display = "block";
  container.innerHTML = "";
  coinCount.textContent = getCoins();

  let shopSkins = JSON.parse(localStorage.getItem("shopSkins") || "{}");

  for (const fighter of shopSkinAvailable) {
    const shopSkinPath = `${fighter.toLowerCase()}_–º–∞–≥–∞–∑–∏–Ω.png`;

    const card = document.createElement("div");
    card.className = "shop-card";

    const img = document.createElement("img");
    img.src = shopSkinPath;
    img.classList.add(shopSkins[fighter] ? "shop-skin" : "locked-skin");
    img.title = shopSkins[fighter] ? "–ö—É–ø–ª–µ–Ω–æ" : "–°–∫–∏–Ω –∑–∞ 100 –º–æ–Ω–µ—Ç";
    card.appendChild(img);

    const name = document.createElement("div");
    name.className = "shop-card-name";
    name.textContent = fighter;
    card.appendChild(name);

    const price = document.createElement("div");
    price.className = "shop-card-price";
    price.textContent = shopSkins[fighter] ? "‚úîÔ∏è –ö—É–ø–ª–µ–Ω–æ" : "üí∞ 100 –º–æ–Ω–µ—Ç";
    card.appendChild(price);

    const btn = document.createElement("button");
    if (shopSkins[fighter]) {
      btn.textContent = "–ö—É–ø–ª–µ–Ω–æ";
      btn.disabled = true;
    } else {
      btn.textContent = "–ö—É–ø–∏—Ç—å";
      btn.onclick = () => {
        if (getCoins() >= 100) {
          setCoins(getCoins() - 100);
          localStorage.setItem("coins", getCoins());
          playSkinRevealAnimation(shopSkinPath, () => {
            shopSkins[fighter] = true;
            localStorage.setItem("shopSkins", JSON.stringify(shopSkins));
            showShop();
          });
        } else {
          alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç!");
        }
      };
    }

    card.appendChild(btn);
    container.appendChild(card);
  }
}

function playSkinRevealAnimation(skinPath, callback) {
  const overlay = document.getElementById("skinRevealOverlay");
  const img = document.getElementById("skinRevealImg");

  img.src = skinPath;
  img.classList.remove("skin-reveal-anim"); // —Å–±—Ä–æ—Å
  void img.offsetWidth;
  img.classList.add("skin-reveal-anim");

  overlay.style.display = "flex";
  setTimeout(() => {
    overlay.style.display = "none";
    callback?.();
  }, 1500); // –¥–ª–∏–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
}
  // –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é
  showMainMenu();
</script>

<!-- –°—Ü–µ–Ω–∞ faceoff –ø–µ—Ä–µ–¥ –±–æ–µ–º -->
<div id="faceoff-scene" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999; justify-content:center; align-items:center; flex-direction:column;">
  <div style="display:flex; justify-content:space-around; align-items:center; width:100%; max-width:800px; flex-wrap:wrap; gap:10px;">
    <img id="faceoff-player" style="width:120px; transform:scaleX(1);">
    <img src="vs.png" alt="VS" style="width:100px; height:auto; filter: drop-shadow(0 0 10px violet);" />
    <img id="faceoff-enemy" style="width:120px; transform:scaleX(-1);">
  </div>
  <div id="faceoff-countdown" style="color:white; font-size:48px; font-weight:bold; margin-top:20px; text-shadow:2px 2px 4px #000;"></div>
</div>
<div id="loreModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000a; z-index:9999; justify-content:center; align-items:center;">
  <div style="background:#222; color:#fff; padding:20px; border-radius:12px; max-width:300px; box-shadow:0 0 10px #000;">
    <h3 id="loreTitle"></h3>
    <p id="loreText" style="font-size:14px;"></p>
    <button onclick="document.getElementById('loreModal').style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>
<!-- –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–∫–∏–Ω–∞ -->
<div id="skinRevealOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:9999; justify-content:center; align-items:center;">
  <img id="skinRevealImg" src="" style="width:200px; border:3px solid gold; border-radius:12px;" />
</div>
</body>
</html>